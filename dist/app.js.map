{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./db.js","webpack:///./src/app.js","webpack:///./src/controllers/data.js","webpack:///./src/models/data.js","webpack:///external \"body-parser\"","webpack:///external \"express\"","webpack:///external \"mongodb\""],"names":["MongoClient","require","state","db","exports","connect","url","done","err","get","express","bodyParser","app","dataController","use","req","res","next","setHeader","json","urlencoded","extended","console","log","listen","getPlaces","send","Data","query","min_latitude","min_longitude","max_latitude","max_longitude","city_id","limit","cursor","docs","sendStatus","ObjectID","paginate","array","page_size","page_number","slice","inRange","min","max","val","filters","cb","filter","collection","findOne","filteredList","test","latitude","longitude","item"],"mappings":";;QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;AClFA,MAAMA,WAAW,GAAGC,mBAAO,CAAC,wBAAD,CAAP,CAAmBD,WAAvC;;AAEA,MAAME,KAAK,GAAG;AACZC,IAAE,EAAE;AADQ,CAAd;;AAIAC,OAAO,CAACC,OAAR,GAAkB,CAACC,GAAD,EAAMC,IAAN,KAAe;AAC/B,MAAIL,KAAK,CAACC,EAAV,EAAc,OAAOD,KAAK,CAACC,EAAb;AAEdH,aAAW,CAACK,OAAZ,CAAoBC,GAApB,EAAyB,CAACE,GAAD,EAAML,EAAN,KAAa;AACpC,QAAIK,GAAJ,EAAS,OAAOD,IAAI,CAACC,GAAD,CAAX;AAETN,SAAK,CAACC,EAAN,GAAWA,EAAX;AACAI,QAAI;AACL,GALD;AAMD,CATD;;AAWAH,OAAO,CAACK,GAAR,GAAc,MAAMP,KAAK,CAACC,EAA1B,C;;;;;;;;;;;ACjBA,MAAMO,OAAO,GAAGT,mBAAO,CAAC,wBAAD,CAAvB;;AACA,MAAMU,UAAU,GAAGV,mBAAO,CAAC,gCAAD,CAA1B;;AACA,MAAMW,GAAG,GAAGF,OAAO,EAAnB;;AAEA,MAAMP,EAAE,GAAGF,mBAAO,CAAC,sBAAD,CAAlB;;AAEA,MAAMY,cAAc,GAAGZ,mBAAO,CAAC,qDAAD,CAA9B;;AAEAW,GAAG,CAACE,GAAJ,CAAQ,UAAUC,GAAV,EAAeC,GAAf,EAAoBC,IAApB,EAA0B;AAChCD,KAAG,CAACE,SAAJ,CAAc,6BAAd,EAA6C,GAA7C,EADgC,CAEhC;;AACAF,KAAG,CAACE,SAAJ,CAAc,8BAAd,EAA8C,WAA9C;AACAF,KAAG,CAACE,SAAJ,CAAc,8BAAd,EAA8C,+BAA9C;AACAF,KAAG,CAACE,SAAJ,CAAc,kCAAd,EAAkD,IAAlD;AACAD,MAAI;AACL,CAPD;AAQAL,GAAG,CAACE,GAAJ,CAAQH,UAAU,CAACQ,IAAX,EAAR;AACAP,GAAG,CAACE,GAAJ,CAAQH,UAAU,CAACS,UAAX,CAAsB;AAAEC,UAAQ,EAAE;AAAZ,CAAtB,CAAR,E,CAEA;;AACAlB,EAAE,CAACE,OAAH,CAAW,gCAAX,EAA8CG,GAAD,IAAS;AACpD,MAAIA,GAAJ,EAAS,OAAOc,OAAO,CAACC,GAAR,CAAYf,GAAZ,CAAP;AAETI,KAAG,CAACY,MAAJ,CAAW,IAAX,EAAiB,MAAM;AACrBF,WAAO,CAACC,GAAR,CAAY,kBAAZ;AACD,GAFD;AAGD,CAND;AAQAX,GAAG,CAACH,GAAJ,CAAQ,SAAR,EAAmBI,cAAc,CAACY,SAAlC;AAEAb,GAAG,CAACH,GAAJ,CAAQ,GAAR,EAAa,CAACM,GAAD,EAAMC,GAAN,KAAc;AACzBA,KAAG,CAACU,IAAJ,CAAS,8BAAT;AACD,CAFD,E;;;;;;;;;;;AC1BA,MAAMC,IAAI,GAAG1B,mBAAO,CAAC,4CAAD,CAApB;;AAEAG,OAAO,CAACqB,SAAR,GAAoB,CAACV,GAAD,EAAMC,GAAN,KAAc;AAChC,QAAM;AAAEY,SAAK,GAAG;AAAV,MAAiBb,GAAvB;AACA,QAAM;AACJc,gBADI;AAEJC,iBAFI;AAGJC,gBAHI;AAIJC,iBAJI;AAKJC,WAAO,GAAG,KALN;AAMJC,SAAK,GAAG,KANJ;AAOJC,UAAM,GAAG;AAPL,MAQFP,KARJ;AAUAD,MAAI,CAACF,SAAL,CAAe;AACbI,gBADa;AAEbC,iBAFa;AAGbC,gBAHa;AAIbC,iBAJa;AAKbC;AALa,GAAf,EAMGC,KANH,EAMUC,MANV,EAMkB,CAAC3B,GAAD,EAAM4B,IAAN,KAAe;AAC/B,QAAI5B,GAAJ,EAAS;AACPc,aAAO,CAACC,GAAR,CAAYf,GAAZ;AACA,aAAOQ,GAAG,CAACqB,UAAJ,CAAe,GAAf,CAAP;AACD;;AAEDrB,OAAG,CAACU,IAAJ,CAASU,IAAT;AACD,GAbD;AAcD,CA1BD,C;;;;;;;;;;;ACJA,MAAMjC,EAAE,GAAGF,mBAAO,CAAC,yBAAD,CAAlB;;AACA,MAAMqC,QAAQ,GAAGrC,mBAAO,CAAC,wBAAD,CAAP,CAAmBqC,QAApC;;AAEA,MAAMC,QAAQ,GAAG,CAACC,KAAD,EAAQC,SAAR,EAAmBC,WAAnB,KAAmCF,KAAK,CAACG,KAAN,CAAY,CAACD,WAAW,GAAG,CAAf,IAAoBD,SAAhC,EAA2CC,WAAW,GAAGD,SAAzD,CAApD;;AAEA,MAAMG,OAAO,GAAG,CAACC,GAAD,EAAMC,GAAN,EAAWC,GAAX,KAAmBA,GAAG,IAAIF,GAAP,IAAcE,GAAG,IAAID,GAAxD;;AAEA1C,OAAO,CAACqB,SAAR,GAAoB,CAACuB,OAAD,EAAkBd,KAAlB,EAA8BC,MAA9B,EAA2Cc,EAA3C,KAAsE;AACxF,QAAM;AACJhB;AADI,MAEFe,OAFJ;AAIA,QAAME,MAAM,GAAG,EAAf;AAEA,MAAIjB,OAAJ,EAAaiB,MAAM,CAACjB,OAAP,GAAiBA,OAAjB;AAEb9B,IAAE,CAACM,GAAH,GAAS0C,UAAT,CAAoB,QAApB,EAA8BC,OAA9B,CAAsCF,MAAtC,EAA8C,CAAC1C,GAAD,EAAM4B,IAAN,KAAe;AAC3D,QAAI,CAAC,CAACA,IAAN,EAAYa,EAAE,CAAC,IAAD,EAAOb,IAAP,CAAF,CAAZ,KACK;AACH,YAAMiB,YAAY,GAAG,CAAC;AACpBC,YAAI,EAAE,CADc;AAEpBC,gBAAQ,EAAE,GAFU;AAGpBC,iBAAS,EAAE;AAHS,OAAD,EAKrB;AACEF,YAAI,EAAE,CADR;AAEEC,gBAAQ,EAAE,GAFZ;AAGEC,iBAAS,EAAE;AAHb,OALqB,EAUrB;AACEF,YAAI,EAAE,CADR;AAEEC,gBAAQ,EAAE,GAFZ;AAGEC,iBAAS,EAAE;AAHb,OAVqB,EAclBN,MAdkB,CAcXO,IAAI,IAAI;AAChB,cAAM;AACJF,kBADI;AAEJC;AAFI,YAGFC,IAHJ;AAIA,cAAM;AACJ5B,sBAAY,GAAG,CAAC,CADZ;AAEJC,uBAAa,GAAG,CAAC,CAFb;AAGJC,sBAAY,GAAG,IAHX;AAIJC,uBAAa,GAAG;AAJZ,YAKFgB,OALJ;AAOA,eAAOJ,OAAO,CAACf,YAAD,EAAeE,YAAf,EAA6BwB,QAA7B,CAAP,IAAiDX,OAAO,CAACd,aAAD,EAAgBE,aAAhB,EAA+BwB,SAA/B,CAA/D;AACD,OA3BoB,CAArB;AA6BAP,QAAE,CAACzC,GAAD,EAAM+B,QAAQ,CAACc,YAAD,EAAenB,KAAf,EAAsBC,MAAtB,CAAd,CAAF;AACD;AACF,GAlCD;AAmCD,CA5CD,C;;;;;;;;;;;ACTA,wC;;;;;;;;;;;ACAA,oC;;;;;;;;;;;ACAA,oC","file":"app.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/app.js\");\n","const MongoClient = require('mongodb').MongoClient\n\nconst state = {\n  db: null\n}\n\nexports.connect = (url, done) => {\n  if (state.db) return state.db\n\n  MongoClient.connect(url, (err, db) => {\n    if (err) return done(err)\n\n    state.db = db\n    done()\n  })\n}\n\nexports.get = () => state.db","const express = require('express')\nconst bodyParser = require('body-parser')\nconst app = express()\n\nconst db = require('../db')\n\nconst dataController = require('./controllers/data')\n\napp.use(function (req, res, next) {\n  res.setHeader('Access-Control-Allow-Origin', '*')\n  // 'GET, POST, OPTIONS, PUT, PATCH, DELETE'\n  res.setHeader('Access-Control-Allow-Methods', 'GET, POST')\n  res.setHeader('Access-Control-Allow-Headers', 'X-Requested-With,content-type')\n  res.setHeader('Access-Control-Allow-Credentials', true)\n  next()\n})\napp.use(bodyParser.json())\napp.use(bodyParser.urlencoded({ extended: true }))\n\n// db.connect('mongodb://mongo:27017/gate', (err) => {\ndb.connect('mongodb://127.0.0.1:27017/gate', (err) => {\n  if (err) return console.log(err)\n\n  app.listen(3012, () => {\n    console.log('API app started!')\n  })\n})\n\napp.get('/places', dataController.getPlaces)\n\napp.get('/', (req, res) => {\n  res.send('What did u want to see here?')\n})","/*\n@flow\n*/\n\nconst Data = require('../models/data')\n\nexports.getPlaces = (req, res) => {\n  const { query = {} } = req\n  const {\n    min_latitude,\n    min_longitude,\n    max_latitude,\n    max_longitude,\n    city_id = false,\n    limit = 99999,\n    cursor = 1\n  } = query\n\n  Data.getPlaces({\n    min_latitude,\n    min_longitude,\n    max_latitude,\n    max_longitude,\n    city_id\n  }, limit, cursor, (err, docs) => {\n    if (err) {\n      console.log(err);\n      return res.sendStatus(500);\n    }\n\n    res.send(docs);\n  })\n}\n","// @flow\n\nconst db = require('../../db')\nconst ObjectID = require('mongodb').ObjectID\n\nconst paginate = (array, page_size, page_number) => array.slice((page_number - 1) * page_size, page_number * page_size)\n\nconst inRange = (min, max, val) => val >= min && val <= max\n\nexports.getPlaces = (filters: Object, limit: any, cursor: any, cb: (any, any) => void) => {\n  const {\n    city_id\n  } = filters\n\n  const filter = {}\n\n  if (city_id) filter.city_id = city_id\n\n  db.get().collection('places').findOne(filter, (err, docs) => {\n    if (!!docs) cb(true, docs)\n    else {\n      const filteredList = [{\n        test: 1,\n        latitude: '0',\n        longitude: '20'\n      },\n      {\n        test: 2,\n        latitude: '0',\n        longitude: '0'\n      },\n      {\n        test: 3,\n        latitude: '0',\n        longitude: '0'\n      }].filter(item => {\n        const {\n          latitude,\n          longitude\n        } = item\n        const {\n          min_latitude = -1,\n          min_longitude = -1,\n          max_latitude = 9999,\n          max_longitude = 9999\n        } = filters\n\n        return inRange(min_latitude, max_latitude, latitude) && inRange(min_longitude, max_longitude, longitude)\n      })\n\n      cb(err, paginate(filteredList, limit, cursor))\n    }\n  });\n}","module.exports = require(\"body-parser\");","module.exports = require(\"express\");","module.exports = require(\"mongodb\");"],"sourceRoot":""}